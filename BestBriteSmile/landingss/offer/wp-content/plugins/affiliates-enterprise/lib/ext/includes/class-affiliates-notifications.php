<?php
 class Affiliates_Notifications { const IXAP459 = 'affiliates_notifications'; const IXAP311 = 'registration_enabled'; const IXAP333 = true; const IXAP312 = 'registration_subject'; const IXAP314 = 'registration_message'; const IXAP313 = '[site_title] Your username and password'; const IXAP315 = 'Username: [username]<br/>
Password: [password]<br/>
[site_login_url]<br/>'; const IXAP316 = 'enabled'; const IXAP317 = 'notify_admin'; const IXAP318 = 'notify_admin_email'; const IXAP321 = 'notify_admin_status'; const IXAP322 = 'admin_subject'; const IXAP324 = 'admin_message'; const IXAP323 = 'Referral'; const IXAP325 = 'A referral has been credited to the affiliate [affiliate_name] (ID [affiliate_id]) on <a href="[site_url]">[site_title]</a>.<br/>'; const IXAP326 = 'notify_affiliate'; const IXAP328 = 'notify_affiliate_status'; const IXAP329 = 'subject'; const MESSAGE = 'message'; const IXAP330 = 'Referral'; const IXAP331 = 'Hi [affiliate_name],<br/>
A referral has been credited to you on <a href="[site_url]">[site_title]</a>.<br/>
<br/>
Greetings,<br/>
[site_title]<br/>
[site_url]
'; public static function init() { add_filter( 'pre_option_aff_notify_affiliate_user', array( __CLASS__, 'pre_option_aff_notify_affiliate_user' ) ); add_filter( 'affiliates_new_affiliate_user_registration_subject', array( __CLASS__, 'affiliates_new_affiliate_user_registration_subject' ), 10, 2 ); add_filter( 'affiliates_new_affiliate_user_registration_message', array( __CLASS__, 'affiliates_new_affiliate_user_registration_message' ), 10, 2 ); add_filter( 'affiliates_new_affiliate_user_registration_headers', array( __CLASS__, 'affiliates_new_affiliate_user_registration_headers' ), 10, 2 ); $IXAP310 = get_option( 'affiliates_notifications', array() ); if ( !empty( $IXAP310['enabled'] ) && $IXAP310['enabled'] ) { add_action( 'affiliates_referral', array( __CLASS__, 'affiliates_referral' ) ); add_action( 'affiliates_updated_referral', array( __CLASS__, 'affiliates_updated_referral' ), 10, 4 ); } } public static function pre_option_aff_notify_affiliate_user( $IXAP87 ) { $IXAP310 = get_option( 'affiliates_notifications', array() ); $IXAP332 = isset( $IXAP310[Affiliates_Notifications::IXAP311] ) ? $IXAP310[Affiliates_Notifications::IXAP311] : Affiliates_Notifications::IXAP333; if ( $IXAP332 ) { $IXAP87 = 'yes'; } else { $IXAP87 = 'no'; } return $IXAP87; } public static function affiliates_new_affiliate_user_registration_subject( $IXAP341, $IXAP35 ) { $IXAP310 = get_option( 'affiliates_notifications', array() ); $IXAP334 = isset( $IXAP310[Affiliates_Notifications::IXAP312] ) ? $IXAP310[Affiliates_Notifications::IXAP312] : Affiliates_Notifications::IXAP313; $IXAP460 = self::get_registration_tokens( $IXAP35 ); $IXAP341 = self::substitute_tokens( stripslashes( $IXAP334 ), $IXAP460 ); return $IXAP341; } public static function affiliates_new_affiliate_user_registration_message( $message, $IXAP35 ) { $IXAP310 = get_option( 'affiliates_notifications', array() ); $IXAP335 = isset( $IXAP310[Affiliates_Notifications::IXAP314] ) ? $IXAP310[Affiliates_Notifications::IXAP314] : Affiliates_Notifications::IXAP315; $IXAP460 = self::get_registration_tokens( $IXAP35 ); $message = self::substitute_tokens( stripslashes( $IXAP335 ), $IXAP460 ); return $message; } public static function affiliates_new_affiliate_user_registration_headers( $IXAP461 = '', $IXAP35 = array() ) { $IXAP461 .= 'Content-type: text/html; charset="' . get_option( 'blog_charset' ) . '"' . "\r\n"; return $IXAP461; } private static function get_registration_tokens( $IXAP35 ) { $IXAP460 = array(); foreach( $IXAP35 as $IXAP78 => $IXAP87 ) { if ( is_string( $IXAP87 ) ) { $IXAP460[$IXAP78] = $IXAP87; } } $IXAP460['site_title'] = wp_specialchars_decode( get_bloginfo( 'blogname' ), ENT_QUOTES ); $IXAP460['site_url'] = get_bloginfo( 'url' ); $IXAP460 = apply_filters( 'affiliates_registration_tokens', $IXAP460 ); return $IXAP460; } private static function substitute_tokens( $IXAP74, $IXAP460 ) { foreach ( $IXAP460 as $IXAP78 => $IXAP87 ) { if ( key_exists( $IXAP78, $IXAP460 ) ) { $IXAP462 = $IXAP460[$IXAP78]; $IXAP74 = str_replace( "[" . $IXAP78 . "]", $IXAP462, $IXAP74 ); } } return $IXAP74; } public static function affiliates_referral( $IXAP273 ) { global $affiliates_db; $IXAP49 = $affiliates_db->get_tablename( 'referrals' ); if ( $IXAP222 = $affiliates_db->get_objects( "SELECT * FROM $IXAP49 WHERE referral_id = %d", intval( $IXAP273 ) ) ) { if ( isset( $IXAP222[0] ) ) { $IXAP463 = $IXAP222[0]; if ( $IXAP361 = affiliates_get_affiliate( $IXAP463->affiliate_id ) ) { $IXAP310 = get_option( 'affiliates_notifications', array() ); $IXAP337 = isset( $IXAP310[self::IXAP317] ) ? $IXAP310[self::IXAP317] : false; $IXAP319 = isset( $IXAP310[self::IXAP318] ) ? $IXAP310[self::IXAP318] : ''; $IXAP340 = isset( $IXAP310[self::IXAP326] ) ? $IXAP310[self::IXAP326] : false; if ( $IXAP337 || $IXAP340 ) { require_once( dirname( AFFILIATES_PRO_FILE ) . '/lib/ext/includes/class-affiliates-mail.php' ); $IXAP464 = new Affiliates_Mail(); $IXAP464->mailer = 'wp_mail'; $IXAP464->charset = get_option( 'blog_charset' ); $IXAP465 = wp_specialchars_decode( get_bloginfo( 'blogname' ), ENT_QUOTES ); $IXAP466 = get_bloginfo( 'url' ); $IXAP460 = apply_filters( 'affiliates_notifications_tokens', array( 'site_title' => $IXAP465, 'site_url' => $IXAP466, 'affiliate_name' => wp_filter_nohtml_kses( $IXAP361['name'] ), 'affiliate_id' => $IXAP361['affiliate_id'], 'affiliate_email' => $IXAP361['email'], 'referral_status' => $IXAP463->status, 'referral_id' => $IXAP463->referral_id, 'referral_amount' => $IXAP463->amount, 'referral_currency_id' => $IXAP463->currency_id, 'referral_type' => $IXAP463->type, 'referral_reference' => $IXAP463->reference ) ); $IXAP467 = array(); $IXAP212 = array(); if ( !empty( $IXAP463->data ) ) { $IXAP212 = unserialize( $IXAP463->data ); if ( $IXAP212 && is_array( $IXAP212 ) ) { $IXAP467 = array_keys( $IXAP212 ); } } $IXAP467 = apply_filters( 'affiliates_notifications_data_tokens', $IXAP467, $IXAP460 ); $IXAP212 = apply_filters( 'affiliates_notifications_data', $IXAP212, $IXAP467, $IXAP460 ); if ( $IXAP337 ) { $IXAP468 = empty( $IXAP319 ) ? get_bloginfo( 'admin_email' ) : $IXAP319; if ( !empty( $IXAP468 ) ) { $IXAP320 = isset( $IXAP310[Affiliates_Notifications::IXAP321] ) ? $IXAP310[Affiliates_Notifications::IXAP321] : array( AFFILIATES_REFERRAL_STATUS_ACCEPTED ); if ( in_array( $IXAP463->status, $IXAP320 ) ) { $IXAP338 = isset( $IXAP310[self::IXAP322] ) ? $IXAP310[self::IXAP322] : self::IXAP323; $IXAP339 = isset( $IXAP310[self::IXAP324] ) ? $IXAP310[self::IXAP324] : self::IXAP325; $IXAP464->mail( $IXAP468, stripslashes( wp_filter_nohtml_kses( $IXAP338 ) ), stripslashes( wp_filter_post_kses( $IXAP339 ) ), $IXAP460, $IXAP467, $IXAP212 ); } } } if ( $IXAP340 ) { if ( !empty( $IXAP361['email'] ) ) { $IXAP327 = isset( $IXAP310[Affiliates_Notifications::IXAP328] ) ? $IXAP310[Affiliates_Notifications::IXAP328] : array( AFFILIATES_REFERRAL_STATUS_ACCEPTED ); if ( in_array( $IXAP463->status, $IXAP327 ) ) { $IXAP341 = isset( $IXAP310[self::IXAP329] ) ? $IXAP310[self::IXAP329] : self::IXAP330; $message = isset( $IXAP310[self::MESSAGE] ) ? $IXAP310[self::MESSAGE] : self::IXAP331; $IXAP464->mail( $IXAP361['email'], stripslashes( wp_filter_nohtml_kses( $IXAP341 ) ), stripslashes( wp_filter_post_kses( $message ) ), $IXAP460, $IXAP467, $IXAP212 ); } } } } } } } } public static function affiliates_updated_referral( $IXAP273, $IXAP270, $IXAP90, $IXAP276 ) { $IXAP30 = count( $IXAP270 ); for( $IXAP80 = 0; $IXAP80 < $IXAP30; $IXAP80++ ) { if ( $IXAP270[$IXAP80] == 'status' ) { $IXAP61 = $IXAP90[$IXAP80]; $IXAP469 = $IXAP276[$IXAP80]; if ( ( $IXAP61 == AFFILIATES_REFERRAL_STATUS_ACCEPTED ) && ( $IXAP469 == AFFILIATES_REFERRAL_STATUS_PENDING ) ) { self::affiliates_referral( $IXAP273 ); } } } } } add_action( 'init', array( 'Affiliates_Notifications', 'init' ) ); 