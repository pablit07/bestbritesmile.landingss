<?php
 class Affiliates_Campaign { protected static $IXAP147 = null; protected static $IXAP148 = null; protected static $IXAP559 = null; protected static $IXAP560 = null; protected static $IXAP153 = null; protected $campaign_id = null; protected $affiliate_id = null; protected $name = null; protected $description = null; protected $from_date = null; protected $thru_date = null; protected $type = null; protected $status = null; protected $hits = null; protected $visits = null; protected $referrals = null; protected $url = null; public function __construct( $IXAP561 = null ) { self::initialize( $this, $IXAP561 ); } private static function initialize( &$IXAP530, $IXAP561 ) { if ( isset( $IXAP561->campaign_id ) ) { $IXAP530->campaign_id = $IXAP561->campaign_id; } if ( isset( $IXAP561->affiliate_id ) ) { $IXAP530->affiliate_id = $IXAP561->affiliate_id; } if ( isset( $IXAP561->name ) ) { $IXAP530->name = $IXAP561->name; } if ( isset( $IXAP561->description ) ) { $IXAP530->description = $IXAP561->description; } if ( isset( $IXAP561->from_date ) ) { $IXAP530->from_date = $IXAP561->from_date; } if ( isset( $IXAP561->thru_date ) ) { $IXAP530->thru_date = $IXAP561->thru_date; } if ( isset( $IXAP561->type ) ) { $IXAP530->type = $IXAP561->type; } if ( isset( $IXAP561->status ) ) { $IXAP530->status = $IXAP561->status; } } public function create() { global $affiliates_db; $IXAP15 = null; if ( $this->campaign_id === null ) { if ( $this->affiliate_id !== null ) { $IXAP479 = $affiliates_db->get_tablename( 'campaigns' ); if ( $affiliates_db->query( "INSERT INTO $IXAP479 " . "SET affiliate_id = %d, name = %s, description = %s, from_date = %s, thru_date = %s, type = %s, status = %s", intval( $this->affiliate_id ), $this->name, $this->description, $this->from_date, $this->thru_date, $this->type, $this->status ) ) { $this->campaign_id = $affiliates_db->get_value( "SELECT LAST_INSERT_ID()" ); $IXAP15 = $this->campaign_id; } } } return $IXAP15; } public function read( $IXAP164 ) { global $affiliates_db; $IXAP15 = null; $IXAP479 = $affiliates_db->get_tablename( 'campaigns' ); if ( $IXAP562 = $affiliates_db->get_objects( "SELECT * FROM $IXAP479 WHERE campaign_id = %d", intval( $IXAP164 ) ) ) { if ( $IXAP563 = array_shift( $IXAP562 ) ) { self::initialize( $this, $IXAP563 ); $IXAP15 = $this; } } return $IXAP15; } public function update() { global $affiliates_db; $IXAP15 = false; if ( $this->campaign_id !== null ) { $IXAP479 = $affiliates_db->get_tablename( 'campaigns' ); if ( $affiliates_db->query( "UPDATE $IXAP479 " . "SET affiliate_id = %d, name = %s, description = %s, from_date = %s, thru_date = %s, type = %s, status = %s " . "WHERE campaign_id = %d", intval( $this->affiliate_id ), $this->name, $this->description, $this->from_date, $this->thru_date, $this->type, $this->status, intval( $this->campaign_id ) ) ) { $IXAP15 = true; } } return $IXAP15; } public function delete() { global $affiliates_db; $IXAP15 = false; if ( $this->campaign_id !== null ) { $IXAP479 = $affiliates_db->get_tablename( 'campaigns' ); if ( $affiliates_db->query( "DELETE FROM $IXAP479 " . "WHERE campaign_id = %d", intval( $this->campaign_id ) ) ) { $IXAP15 = true; } } return $IXAP15; } public function get_hits( $IXAP36 = null , $IXAP38 = null, $IXAP564 = false ) { global $affiliates_db; $IXAP112 = $affiliates_db->get_tablename( 'hits' ); $IXAP15 = 0; $IXAP565 = " WHERE affiliate_id = %d AND campaign_id = %d "; $IXAP90 = array( $this->affiliate_id, $this->campaign_id ); if ( $IXAP36 ) { if ( $IXAP564 ) { $IXAP37 = date( 'Y-m-d H:i:s', strtotime( $IXAP36 ) ); } else { $IXAP36 = date( 'Y-m-d', strtotime( $IXAP36 ) ); } } if ( $IXAP38 ) { if ( $IXAP564 ) { $IXAP39 = date( 'Y-m-d H:i:s', strtotime( $IXAP38 ) ); } else { $IXAP38 = date( 'Y-m-d', strtotime( $IXAP38 ) + 24*3600 ); } } if ( $IXAP36 && $IXAP38 ) { if ( $IXAP564 ) { $IXAP565 .= " AND datetime >= %s AND datetime < %s "; $IXAP90[] = $IXAP37; $IXAP90[] = $IXAP39; } else { $IXAP565 .= " AND date >= %s AND date < %s "; $IXAP90[] = $IXAP36; $IXAP90[] = $IXAP38; } } else if ( $IXAP36 ) { if ( $IXAP564 ) { $IXAP565 .= " AND datetime >= %s "; $IXAP90[] = $IXAP37; } else { $IXAP565 .= " AND date >= %s "; $IXAP90[] = $IXAP36; } } else if ( $IXAP38 ) { if ( $IXAP564 ) { $IXAP565 .= " AND datetime < %s "; $IXAP90[] = $IXAP39; } else { $IXAP565 .= " AND date < %s "; $IXAP90[] = $IXAP38; } } $IXAP15 = intval( $affiliates_db->get_value( "SELECT sum(count) FROM $IXAP112 $IXAP565", $IXAP90 ) ); return $IXAP15; } public function get_visits( $IXAP36 = null , $IXAP38 = null, $IXAP564 = false ) { global $affiliates_db; $IXAP112 = $affiliates_db->get_tablename( 'hits' ); $IXAP15 = 0; $IXAP565 = " WHERE affiliate_id = %d AND campaign_id = %d "; $IXAP90 = array( $this->affiliate_id, $this->campaign_id ); if ( $IXAP36 ) { if ( $IXAP564 ) { $IXAP37 = date( 'Y-m-d H:i:s', strtotime( $IXAP36 ) ); } else { $IXAP36 = date( 'Y-m-d', strtotime( $IXAP36 ) ); } } if ( $IXAP38 ) { if ( $IXAP564 ) { $IXAP39 = date( 'Y-m-d H:i:s', strtotime( $IXAP38 ) ); } else { $IXAP38 = date( 'Y-m-d', strtotime( $IXAP38 ) + 24*3600 ); } } if ( $IXAP36 && $IXAP38 ) { if ( $IXAP564 ) { $IXAP565 .= " AND datetime >= %s AND datetime < %s "; $IXAP90[] = $IXAP37; $IXAP90[] = $IXAP39; } else { $IXAP565 .= " AND date >= %s AND date < %s "; $IXAP90[] = $IXAP36; $IXAP90[] = $IXAP38; } } else if ( $IXAP36 ) { if ( $IXAP564 ) { $IXAP565 .= " AND datetime >= %s "; $IXAP90[] = $IXAP37; } else { $IXAP565 .= " AND date >= %s "; $IXAP90[] = $IXAP36; } } else if ( $IXAP38 ) { if ( $IXAP564 ) { $IXAP565 .= " AND datetime < %s "; $IXAP90[] = $IXAP39; } else { $IXAP565 .= " AND date < %s "; $IXAP90[] = $IXAP38; } } $IXAP15 = intval( $affiliates_db->get_value( "SELECT SUM(visits) FROM " . "(SELECT count(DISTINCT IP) visits FROM $IXAP112 $IXAP565 GROUP BY DATE) tmp", $IXAP90 ) ); return $IXAP15; } function get_referrals( $IXAP36 = null , $IXAP38 = null, $IXAP247 = null, $IXAP564 = false ) { global $affiliates_db; $IXAP49 = $affiliates_db->get_tablename( 'referrals' ); $IXAP15 = 0; $IXAP565 = " WHERE affiliate_id = %d AND campaign_id = %d "; $IXAP90 = array( $this->affiliate_id, $this->campaign_id ); if ( $IXAP36 ) { if ( $IXAP564 ) { $IXAP36 = date( 'Y-m-d H:i:s', strtotime( $IXAP36 ) ); } else { $IXAP36 = date( 'Y-m-d', strtotime( $IXAP36 ) ); } } if ( $IXAP38 ) { if ( $IXAP564 ) { $IXAP38 = date( 'Y-m-d H:i:s', strtotime( $IXAP38 ) ); } else { $IXAP38 = date( 'Y-m-d', strtotime( $IXAP38 ) + 24*3600 ); } } if ( $IXAP36 && $IXAP38 ) { $IXAP565 .= " AND datetime >= %s AND datetime < %s "; $IXAP90[] = $IXAP36; $IXAP90[] = $IXAP38; } else if ( $IXAP36 ) { $IXAP565 .= " AND datetime >= %s "; $IXAP90[] = $IXAP36; } else if ( $IXAP38 ) { $IXAP565 .= " AND datetime < %s "; $IXAP90[] = $IXAP38; } if ( !empty( $IXAP247 ) ) { $IXAP565 .= " AND status = %s "; $IXAP90[] = $IXAP247; } else { $IXAP565 .= " AND status IN ( %s, %s ) "; $IXAP90[] = AFFILIATES_REFERRAL_STATUS_ACCEPTED; $IXAP90[] = AFFILIATES_REFERRAL_STATUS_CLOSED; } $IXAP15 = intval( $affiliates_db->get_value( "SELECT count(*) FROM $IXAP49 $IXAP565", $IXAP90 ) ); return $IXAP15; } public function get_totals( $IXAP36 = null , $IXAP38 = null, $IXAP247 = null, $IXAP42 = null ) { global $affiliates_db; $IXAP49 = $affiliates_db->get_tablename( 'referrals' ); $IXAP565 = " WHERE affiliate_id = %d AND campaign_id = %d "; $IXAP90 = array( $this->affiliate_id, $this->campaign_id ); if ( !empty( $IXAP42 ) ) { $IXAP565 .= " AND currency_id = %s "; $IXAP90[] = $IXAP42; } if ( $IXAP36 ) { $IXAP36 = date( 'Y-m-d', strtotime( $IXAP36 ) ); } if ( $IXAP38 ) { $IXAP38 = date( 'Y-m-d', strtotime( $IXAP38 ) + 24*3600 ); } if ( $IXAP36 && $IXAP38 ) { $IXAP565 .= " AND datetime >= %s AND datetime < %s "; $IXAP90[] = $IXAP36; $IXAP90[] = $IXAP38; } else if ( $IXAP36 ) { $IXAP565 .= " AND datetime >= %s "; $IXAP90[] = $IXAP36; } else if ( $IXAP38 ) { $IXAP565 .= " AND datetime < %s "; $IXAP90[] = $IXAP38; } if ( !empty( $IXAP247 ) ) { $IXAP565 .= " AND status = %s "; $IXAP90[] = $IXAP247; } else { $IXAP565 .= " AND status IN ( %s, %s ) "; $IXAP90[] = AFFILIATES_REFERRAL_STATUS_ACCEPTED; $IXAP90[] = AFFILIATES_REFERRAL_STATUS_CLOSED; } $IXAP245 = $affiliates_db->get_objects( "SELECT SUM(amount) total, currency_id FROM $IXAP49
			$IXAP565
			GROUP BY currency_id
			", $IXAP90 ); if ( $IXAP245 ) { $IXAP15 = array(); foreach( $IXAP245 as $IXAP235 ) { if ( ( $IXAP235->currency_id !== null ) && ( $IXAP235->total !== null ) ) { $IXAP15[$IXAP235->currency_id] = $IXAP235->total; } } return $IXAP15; } else { return false; } } public function get_url( $IXAP105 = array() ) { $IXAP153 = self::$IXAP153; if ( !empty( $IXAP105['url'] ) ) { $IXAP153 = $IXAP105['url'] ; } return Affiliates_Url_Renderer::get_affiliate_url( $IXAP153, $this->affiliate_id, $this->campaign_id ); } public function __get( $name ) { $IXAP87 = null; switch( $name ) { case 'campaign_id' : case 'affiliate_id' : case 'name' : case 'description' : case 'from_date' : case 'thru_date' : case 'type' : case 'status' : $IXAP87 = $this->$name; break; case 'hits' : $IXAP87 = $this->get_hits(); break; case 'visits' : $IXAP87 = $this->get_visits(); break; case 'referrals' : $IXAP87 = $this->get_referrals(); break; case 'totals' : $IXAP87 = $this->get_totals(); break; case 'url' : $IXAP87 = $this->get_url(); break; } return $IXAP87; } public function __set( $name, $IXAP87 ) { switch( $name ) { case 'campaign_id' : case 'affiliate_id' : case 'name' : case 'description' : case 'from_date' : case 'thru_date' : case 'type' : case 'status' : $this->$name = $IXAP87; break; } return $IXAP87; } public function to_array() { $IXAP15 = array( 'campaign_id' => $this->campaign_id, 'affiliate_id' => $this->affiliate_id, 'name' => $this->name, 'description' => $this->description, 'from_date' => $this->from_date, 'thru_date' => $this->thru_date, 'type' => $this->type, 'status' => $this->status, 'hits' => $this->get_hits(), 'visits' => $this->get_visits(), 'referrals' => $this->get_referrals(), 'totals' => $this->get_totals() ); return $IXAP15; } public static function init() { } public static function is_affiliate_campaign( $IXAP24, $IXAP164 ) { return self::get_affiliate_campaign($IXAP24, $IXAP164) !== null; } public static function get_affiliate_campaign( $IXAP24, $IXAP164 ) { global $affiliates_db; $IXAP530 = null; $IXAP479 = $affiliates_db->get_tablename( 'campaigns' ); if ( $IXAP15 = $affiliates_db->get_objects( "SELECT * FROM $IXAP479 WHERE campaign_id = %d AND affiliate_id = %d", intval( $IXAP164 ), intval( $IXAP24 ) ) ) { if ( $IXAP15 = array_shift( $IXAP15 ) ) { $IXAP530 = new Affiliates_Campaign( $IXAP15 ); } } return $IXAP530; } public static function get_campaigns( $IXAP24 = null, $IXAP35 = array() ) { global $affiliates_db; $IXAP479 = $affiliates_db->get_tablename( 'campaigns' ); $IXAP529 = array(); if ( empty( $IXAP24 ) ) { $IXAP55 = $affiliates_db->get_objects( "SELECT * FROM $IXAP479" ); } else if ( is_array( $IXAP24 ) ) { if ( count( $IXAP24 ) > 0 ) { $IXAP252 = array_map( 'intval', implode(',', $IXAP24 ) ); $IXAP55 = $affiliates_db->get_objects( "SELECT * FROM $IXAP479 WHERE affiliate_id IN (" . $IXAP252 . ")" ); } } else { $IXAP55 = $affiliates_db->get_objects( "SELECT * FROM $IXAP479 WHERE affiliate_id = %d", intval( $IXAP24 ) ); } foreach( $IXAP55 as $IXAP15 ) { $IXAP529[] = new Affiliates_Campaign( $IXAP15 ); } return $IXAP529; } public static function evaluate( $IXAP566, $IXAP24, &$IXAP567 = null ) { $IXAP566 = trim( $IXAP566 ); $IXAP566 = strtolower( $IXAP566 ); if ( !self::is_affiliate_campaign( $IXAP24, $IXAP566 ) ) { $IXAP566 = null; } return $IXAP566; } public static function set_pname( $IXAP147 ) { self::$IXAP147 = $IXAP147; } public static function get_pname() { return self::$IXAP147; } public static function set_cname( $IXAP148 ) { self::$IXAP148 = $IXAP148; } public static function get_name() { return self::$IXAP148; } public static function set_url_renderer( $IXAP561 ) { self::$IXAP559 = $IXAP561; } public static function get_url_renderer() { return self::$IXAP559; } public static function set_affiliate_id_encoder( $IXAP149 ) { self::$IXAP560 = $IXAP149; } public static function get_affiliate_id_encoder() { return self::$IXAP560; } public static function set_base_url( $IXAP163 ) { self::$IXAP153 = $IXAP163; } public static function get_base_url() { return self::$IXAP153; } } Affiliates_Campaign::init(); 