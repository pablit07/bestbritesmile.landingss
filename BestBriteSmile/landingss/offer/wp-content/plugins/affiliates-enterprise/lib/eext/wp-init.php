<?php
 global $affiliates_options, $affiliates_version, $IXAP0, $IXAP476, $IXAP477; if ( !isset( $IXAP477 ) ) { $IXAP477 = array(); } if ( !isset( $IXAP476 ) ) { $IXAP476 = AFFILIATES_EEXT_VERSION; } add_action( 'init', 'affiliates_enterprise_version_check' ); function affiliates_enterprise_version_check() { global $IXAP476, $IXAP477; $IXAP2 = get_option( 'affiliates_enterprise_plugin_version', null ); $IXAP476 = AFFILIATES_EEXT_VERSION; if ( version_compare( $IXAP2, $IXAP476 ) < 0 ) { if ( affiliates_enterprise_update( $IXAP2 ) ) { update_option( 'affiliates_enterprise_plugin_version', $IXAP476 ); } else { $IXAP477[] = '<div class="error">Updating Affiliates E-Ext FAILED.</div>'; } } } function affiliates_enterprise_admin_notices() { global $IXAP477; if ( !empty( $IXAP477 ) ) { foreach ( $IXAP477 as $IXAP3 ) { echo $IXAP3; } } } add_action( 'admin_notices', 'affiliates_enterprise_admin_notices' ); function affiliates_enterprise_activate( $IXAP4 = false ) { if ( is_multisite() && $IXAP4 ) { $IXAP5 = affiliates_get_blogs(); foreach ( $IXAP5 as $IXAP6 ) { switch_to_blog( $IXAP6 ); wp_cache_reset(); affiliates_enterprise_setup(); restore_current_blog(); } } else { affiliates_pro_setup(); } } function affiliates_enterprise_setup() { global $affiliates_db, $wpdb; if ( affiliates_enterprise_check_dependencies() ) { $IXAP7 = null; $IXAP8 = null; if ( ! empty( $wpdb->charset ) ) { $IXAP7 = $wpdb->charset; } if ( ! empty( $wpdb->collate ) ) { $IXAP8 = $wpdb->collate; } $affiliates_db->create_tables( $IXAP7, $IXAP8 ); affiliates_enterprise_update(); } } function affiliates_enterprise_wpmu_new_blog( $IXAP6, $IXAP9 ) { if ( is_multisite() ) { if ( affiliates_is_sitewide_plugin() ) { switch_to_blog( $IXAP6 ); wp_cache_reset(); affiliates_enterprise_setup(); restore_current_blog(); } } } function affiliates_enterprise_delete_blog( $IXAP6, $IXAP10 = false ) { if ( is_multisite() ) { if ( affiliates_is_sitewide_plugin() ) { switch_to_blog( $IXAP6 ); wp_cache_reset(); affiliates_enterprise_cleanup( $IXAP10 ); restore_current_blog(); } } } register_activation_hook( AFFILIATES_ENTERPRISE_PLUGIN_FILE, 'affiliates_enterprise_activate' ); add_action( 'wpmu_new_blog', 'affiliates_enterprise_wpmu_new_blog', 12, 2 ); add_action( 'delete_blog', 'affiliates_enterprise_delete_blog', 10, 2 ); function affiliates_enterprise_update( $IXAP2 = null ) { global $affiliates_db, $wpdb; $IXAP15 = true; $IXAP478 = array(); if ( affiliates_enterprise_check_dependencies() ) { $IXAP7 = null; $IXAP8 = null; if ( ! empty( $wpdb->charset ) ) { $IXAP7 = $wpdb->charset; } if ( ! empty( $wpdb->collate ) ) { $IXAP8 = $wpdb->collate; } $IXAP479 = $affiliates_db->get_tablename( 'campaigns' ); if ( $affiliates_db->get_value( "SHOW TABLES LIKE '" . $IXAP479 . "'" ) != $IXAP479 ) { $IXAP98 = "CREATE TABLE " . $IXAP479 . " (
			campaign_id  BIGINT(20) UNSIGNED NOT NULL AUTO_INCREMENT,
			affiliate_id BIGINT(20) UNSIGNED NOT NULL,
			name         VARCHAR(100) DEFAULT NULL,
			description  LONGTEXT DEFAULT NULL,
			from_date    DATE DEFAULT NULL,
			thru_date    DATE DEFAULT NULL,
			type         VARCHAR(10) DEFAULT NULL,
			status       VARCHAR(10) DEFAULT NULL,
			PRIMARY KEY  (campaign_id),
			INDEX        aff_cmp_acn (affiliate_id,campaign_id,name),
			INDEX        aff_cmp_nam (name(20))
			) $IXAP97;"; $IXAP478[] = $IXAP98; } foreach ( $IXAP478 as $IXAP98 ) { if ( $affiliates_db->query( $IXAP98 ) === false ) { $IXAP15 = false; } } } return $IXAP15; } remove_action( 'deactivate_' . plugin_basename( AFFILIATES_PRO_FILE ), 'affiliates_pro_deactivate' ); register_deactivation_hook( AFFILIATES_ENTERPRISE_PLUGIN_FILE, 'affiliates_enterprise_deactivate' ); function affiliates_enterprise_deactivate( $IXAP4 = false ) { if ( is_multisite() && $IXAP4 ) { if ( get_option( 'aff_delete_network_data', false ) ) { $IXAP5 = affiliates_get_blogs(); foreach ( $IXAP5 as $IXAP6 ) { switch_to_blog( $IXAP6 ); wp_cache_reset(); affiliates_enterprise_cleanup( true ); restore_current_blog(); } } } else { affiliates_enterprise_cleanup(); } } function affiliates_enterprise_cleanup( $IXAP11 = false ) { global $affiliates_db; $IXAP12 = get_option( 'aff_delete_data', false ) || $IXAP11; if ( $IXAP12 ) { $IXAP47 = $affiliates_db->get_tablename( 'affiliates' ); if ( $IXAP480 = $affiliates_db->get_objects( "SELECT affiliate_id FROM $IXAP47" ) ) { foreach( $IXAP480 as $IXAP361 ) { delete_option( Affiliates_Multi_Tier::IXAP481 . '_' . intval( $IXAP361->affiliate_id ) ); } } $affiliates_db->drop_tables(); delete_option( 'affiliates_pro_plugin_version' ); delete_option( 'affiliates_enterprise_plugin_version' ); delete_option( Affiliates_Referral::IXAP13 ); delete_option( Affiliates_Referral::IXAP14 ); delete_option( 'affiliates_notifications' ); delete_option( Affiliates_Multi_Tier::IXAP482 ); delete_option( Affiliates_Multi_Tier::IXAP481 ); delete_option( Affiliates_Multi_Tier::IXAP483 ); delete_option( Affiliates_Multi_Tier::IXAP484 ); delete_option( Affiliates_Multi_Tier::IXAP485 ); delete_option( Affiliates_Multi_Tier::IXAP486 ); } affiliates_deactivate(); } add_action( 'init', 'affiliates_enterprise_init' ); function affiliates_enterprise_init() { global $IXAP477; load_plugin_textdomain( AFFILIATES_ENTERPRISE_PLUGIN_DOMAIN, null, AFFILIATES_PLUGIN_NAME . '/lib/eext/languages' ); affiliates_enterprise_check_dependencies(); } function affiliates_enterprise_check_dependencies() { global $IXAP477; $IXAP15 = true; $active_plugins = get_option( 'active_plugins', array() ); if ( is_multisite() ) { $IXAP17 = get_site_option( 'active_sitewide_plugins', array() ); $IXAP17 = array_keys( $IXAP17 ); $active_plugins = array_merge( $active_plugins, $IXAP17 ); } $IXAP487 = in_array( 'affiliates-pro/affiliates-pro.php', $active_plugins ); if ( $IXAP487 ) { $IXAP477[] = "<div class='error'>" . __( 'The <a href="http://www.itthinx.com/plugins/affiliates-pro" target="_blank">Affiliates Pro</a> plugin must be deactivated or removed.', AFFILIATES_ENTERPRISE_PLUGIN_DOMAIN ) . "</div>"; } if ( $IXAP487 ) { include_once( ABSPATH . 'wp-admin/includes/plugin.php' ); deactivate_plugins( AFFILIATES_PLUGIN_BASENAME ); $IXAP15 = false; } return $IXAP15; } require_once( dirname( AFFILIATES_ENTERPRISE_PLUGIN_FILE ) . '/lib/eext/interfaces.php' ); require_once( dirname( AFFILIATES_ENTERPRISE_PLUGIN_FILE ) . '/lib/eext/abstract/abstract.php' ); require_once( dirname( AFFILIATES_ENTERPRISE_PLUGIN_FILE ) . '/lib/eext/includes/includes.php' ); require_once( dirname( AFFILIATES_ENTERPRISE_PLUGIN_FILE ) . '/lib/eext/wordpress/wordpress.php' ); include_once( AFFILIATES_CORE_LIB . '/class-affiliates-utility.php' ); include_once( AFFILIATES_CORE_LIB . '/class-affiliates-pagination.php' ); include_once( AFFILIATES_CORE_LIB . '/class-affiliates-date-helper.php' ); add_action( 'widgets_init', 'affiliates_enterprise_widgets_init' ); function affiliates_enterprise_widgets_init() { } add_action( 'admin_init', 'affiliates_enterprise_admin_init' ); function affiliates_enterprise_admin_init() { global $IXAP476; wp_register_style( 'smoothness', AFFILIATES_CORE_URL . '/css/smoothness/jquery-ui-1.8.16.custom.css', array(), $IXAP476 ); wp_register_style( 'affiliates_enterprise_admin', AFFILIATES_ENTERPRISE_PLUGIN_URL . 'css/affiliates_enterprise_admin.css', array(), $IXAP476 ); } add_action( 'affiliates_admin_menu', 'affiliates_enterprise_affiliates_admin_menu' ); function affiliates_enterprise_affiliates_admin_menu( $IXAP19 ) { foreach ( $IXAP19 as $IXAP20 ) { add_action( 'admin_print_styles-' . $IXAP20, 'affiliates_enterprise_admin_print_styles' ); add_action( 'admin_print_scripts-' . $IXAP20, 'affiliates_enterprise_admin_print_scripts' ); } } function affiliates_enterprise_admin_print_styles() { wp_enqueue_style( 'smoothness' ); wp_enqueue_style( 'affiliates_enterprise_admin' ); } function affiliates_enterprise_admin_print_scripts() { global $IXAP476; } 