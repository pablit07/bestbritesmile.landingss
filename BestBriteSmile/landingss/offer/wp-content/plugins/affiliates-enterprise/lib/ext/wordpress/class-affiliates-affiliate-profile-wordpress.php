<?php
class Affiliates_Affiliate_Profile_WordPress extends Affiliates_Affiliate_Profile { const IXAP183 = 'affiliate-profile-nonce'; const IXAP414 = 'edit-profile'; static function init() { add_shortcode( 'affiliates_affiliate_profile', array( __CLASS__, 'profile_shortcode' ) ); } static function profile_shortcode( $IXAP220, $IXAP167 = null ) { $IXAP15 = null; $IXAP105 = shortcode_atts( self::$IXAP180, $IXAP220 ); return self::render_profile( $IXAP105 ); } static function render_profile( $IXAP105 = array() ) { global $affiliates_options, $affiliates_db; wp_enqueue_style( 'affiliates' ); $IXAP62 = ''; $IXAP24 = Affiliates_Affiliate_WordPress::get_user_affiliate_id(); if ( $IXAP24 === false ) { return $IXAP62; } $IXAP361 = Affiliates_Affiliate_WordPress::get_affiliate( $IXAP24 ); $IXAP415 = isset( $IXAP105['show_name'] ) ? $IXAP105['show_name'] : self::$IXAP180['show_name']; $IXAP416 = $IXAP415 && isset( $IXAP105['edit_name'] ) ? $IXAP105['edit_name'] : self::$IXAP180['edit_name']; $IXAP417 = isset( $IXAP105['show_email'] ) ? $IXAP105['show_email'] : self::$IXAP180['show_email']; $IXAP418 = $IXAP417 && isset( $IXAP105['edit_email'] ) ? $IXAP105['edit_email'] : self::$IXAP180['edit_email']; $IXAP419 = isset( $IXAP105['show_attributes'] ) ? $IXAP105['show_attributes'] : self::$IXAP180['show_attributes']; if ( $IXAP419 ) { $IXAP419 = explode( ",", $IXAP419 ); $IXAP420 = array(); foreach ( $IXAP419 as $IXAP403 ) { $IXAP403 = trim( $IXAP403 ); if ( Affiliates_Attributes::validate_key( $IXAP403 ) ) { $IXAP420[] = $IXAP403; } } $IXAP419 = $IXAP420; } else { $IXAP419 = array(); } $IXAP421 = isset( $IXAP105['edit_attributes'] ) ? $IXAP105['edit_attributes'] : self::$IXAP180['edit_attributes']; if ( $IXAP421 ) { $IXAP420 = explode( ",", $IXAP421 ); $IXAP421 = array(); foreach ( $IXAP420 as $IXAP403 ) { if ( in_array( $IXAP403, $IXAP419 ) ) { $IXAP421[] = $IXAP403; } } } else { $IXAP421 = array(); } if ( isset( $_POST[self::IXAP183] ) ) { if ( !wp_verify_nonce( $_POST[self::IXAP183], self::IXAP414 ) ) { wp_die( __( 'Access denied.', AFFILIATES_PRO_PLUGIN_DOMAIN ) ); } if ( $IXAP416 && isset( $_POST['first_name'] ) && ( $_POST['last_name'] ) ) { $IXAP43 = $_POST['first_name'] . " " . $_POST['last_name']; if ( $IXAP361->name != $IXAP43 ) { if ( $IXAP9 = Affiliates_Affiliate_WordPress::get_affiliate_user_id( $IXAP24 ) ) { if ( $IXAP422 = Affiliates_Utility::filter( $_POST['first_name'] ) ) { update_user_meta( $IXAP9, 'first_name', $IXAP422 ); } if ( $IXAP423 = Affiliates_Utility::filter( $_POST['last_name'] ) ) { update_user_meta( $IXAP9, 'last_name', $IXAP423 ); } } Affiliates_Affiliate_WordPress::update_name( $IXAP24, $IXAP43 ); } } if ( $IXAP418 && isset( $_POST['affiliate_email'] ) && ( $_POST['affiliate_email'] != $IXAP361->email ) ) { if ( ( $IXAP424 = Affiliates_Validator::validate_email( $_POST['affiliate_email'] ) ) && !email_exists( $IXAP424 ) ) { if ( $IXAP424 = Affiliates_Affiliate_WordPress::update_email( $IXAP24, $IXAP424 ) ) { if ( $IXAP9 = Affiliates_Affiliate_WordPress::get_affiliate_user_id( $IXAP24 ) ) { $IXAP425 = array( 'ID' => $IXAP9, 'user_email' => $IXAP424 ); wp_update_user( $IXAP425 ); } } } } foreach ( $IXAP421 as $IXAP403 ) { $IXAP426 = "aff_attr_" . $IXAP403; if ( isset( $_POST[$IXAP426] ) ) { Affiliates_Affiliate_WordPress::update_attribute( $IXAP24, $IXAP403, $_POST[$IXAP426] ); } } } $IXAP361 = Affiliates_Affiliate_WordPress::get_affiliate( $IXAP24 ); $IXAP62 .= '<div class="affiliate-profile">' . '<form id="affiliate-profile" action="" method="post">'; if ( $IXAP415 ) { $IXAP427 = !$IXAP416 ? ' readonly="readonly" ' : ''; if ( $IXAP9 = Affiliates_Affiliate_WordPress::get_affiliate_user_id( $IXAP24 ) ) { $IXAP422 = get_user_meta( $IXAP9, 'first_name', true ); $IXAP423 = get_user_meta( $IXAP9, 'last_name', true ); } else { $IXAP422 = ''; $IXAP423 = ''; } $IXAP62 .= '<div class="field first-name">' . '<label for="first_name">' . __( 'First Name', AFFILIATES_PRO_PLUGIN_DOMAIN ) . '</label>' . '<input ' . $IXAP427 . ' name="first_name" type="text" value="' . esc_attr( $IXAP422 ) . '"/>'. '</div>'; $IXAP62 .= '<div class="field last-name">' . '<label for="last_name">' . __( 'Last Name', AFFILIATES_PRO_PLUGIN_DOMAIN ) . '</label>' . '<input ' . $IXAP427 . ' name="last_name" type="text" value="' . esc_attr( $IXAP423 ) . '"/>'. '</div>'; } if ( $IXAP417 ) { $IXAP427 = !$IXAP418 ? ' readonly="readonly" ' : ''; $IXAP62 .= '<div class="field affiliate-email">' . '<label for="affiliate_email">' . __( 'Email', AFFILIATES_PRO_PLUGIN_DOMAIN ) . '</label>' . '<input ' . $IXAP427 . ' name="affiliate_email" type="text" value="' . esc_attr( $IXAP361->email ) . '"/>'. '</div>'; } if ( $IXAP419 ) { $IXAP25 = $affiliates_db->get_tablename( 'affiliates_attributes' ); $IXAP428 = $affiliates_db->get_objects( "SELECT * FROM $IXAP25 WHERE affiliate_id = %d", $IXAP24 ); $IXAP274 = array(); foreach ( $IXAP428 as $IXAP403 ) { $IXAP274[$IXAP403->attr_key] = $IXAP403->attr_value; } $IXAP429 = Affiliates_Attributes::get_keys(); foreach ( $IXAP419 as $IXAP356 ) { $IXAP359 = isset( $IXAP274[$IXAP356] ) ? $IXAP274[$IXAP356] : ''; $IXAP427 = !in_array( $IXAP356, $IXAP421 ) ? ' readonly="readonly" ' : ''; $IXAP426 = "aff_attr_" . $IXAP356; $IXAP62 .= '<div class="field affiliate-attribute ' . esc_attr( $IXAP356 ) . '">' . '<label for="' . esc_attr( $IXAP426 ) . '">' . __( $IXAP429[$IXAP356], AFFILIATES_PRO_PLUGIN_DOMAIN ) . '</label>' . '<input ' . $IXAP427 . ' name="' . esc_attr( $IXAP426 ) . '" type="text" value="' . esc_attr( $IXAP359 ) . '"/>'. '</div>'; } } if ( $IXAP416 || $IXAP418 || $IXAP421 ) { $IXAP62 .= '<div class="submit">' . wp_nonce_field( self::IXAP414, self::IXAP183, true, false ) . '<input type="submit" value="' . __( 'Save', AFFILIATES_PRO_PLUGIN_DOMAIN ) . '"/>' . '<input type="hidden" value="submitted" name="submitted"/>' . '</div>'; } $IXAP62 .= '</form>'; $IXAP62 .= '</div>'; return $IXAP62; } } Affiliates_Affiliate_Profile_WordPress::init();